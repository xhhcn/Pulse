---
import Icon from './Icon.astro';

interface Props {
  isAdmin?: boolean;
}

const { isAdmin = false } = Astro.props;
---

<nav class="mx-auto mt-2 sm:mt-3 max-w-7xl flex items-center justify-between rounded-xl border border-[#404040]/50 bg-[#1c1c1c] dark:border-[#404040]/50 dark:bg-[#1c1c1c] border-[#a3a3a3]/50 bg-white px-3 sm:px-4 md:px-6 py-2 sm:py-3">
  <!-- Logo -->
  <a href="/" class="flex items-center gap-1.5 sm:gap-2">
    <!-- Dark theme logo -->
    <img width="20" height="20" src="https://img.icons8.com/ios/50/dota.png" alt="dota" class="dark:block hidden w-5 h-5 sm:w-6 sm:h-6 shrink-0" />
    <!-- Light theme logo -->
    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="20" height="20" viewBox="0 0 50 50" class="dark:hidden block w-5 h-5 sm:w-6 sm:h-6 shrink-0">
      <path d="M46,8V6c0-0.552-0.447-1-1-1h-4c-0.396,0-0.714,0.026-1,0.1V5c0-0.552-0.447-1-1-1h-6c-1.734,0-2.361,0.984-2.729,2h-0.812 C29.226,5.689,29,5.286,29,5c0-0.552-0.447-1-1-1h-7c-0.511,0-0.94,0.393-0.995,0.9C19.982,5.11,19.557,6,18.896,6h-2.74 c-0.065-0.077-0.159-0.22-0.24-0.403C15.756,5.234,15.396,5,15,5H5C4.447,5,4,5.448,4,6v8c0,2.823,0.825,6.397,0.999,7.118 l-0.008,1.515l-0.678,0.641C4.113,23.462,4,23.725,4,24v4c0,0.266,0.105,0.52,0.293,0.707L5,29.414v4.424l-0.948,2.846 c-0.061,0.181-0.068,0.374-0.021,0.559l0.929,3.718l-0.907,2.724c-0.103,0.305-0.051,0.641,0.137,0.901C4.377,44.846,4.679,45,5,45 h14c0.266,0,0.52-0.105,0.707-0.293l0.09-0.09C20.328,45.343,21.067,46,22,46h3c0.736,0,1.38-0.321,1.947-0.605 C27.335,45.2,27.736,45,28,45h5c0.266,0,0.52-0.105,0.707-0.293l0.243-0.243c0.063,0.08,0.123,0.159,0.182,0.235 C34.623,45.339,35.13,46,36,46h5c0.553,0,1-0.447,1-1v-0.719l2.758,0.688c0.299,0.077,0.616,0.007,0.86-0.184 c0.243-0.19,0.384-0.483,0.382-0.793c-0.001-0.098-0.063-9.91,0-14.98c0.003-0.27-0.103-0.529-0.293-0.72L45,27.586V23 c0-0.265-0.105-0.52-0.293-0.707l-0.49-0.49l0.605-1.21l0.885-0.885C45.895,19.52,46,19.265,46,19l-0.015-5.01 c0-0.081-0.01-0.161-0.029-0.24l-0.896-3.632l0.835-1.67C45.964,8.309,46,8.155,46,8z M34.089,12l3.044,2l-1.015,6L28,14L34.089,12z M15,38l-4-3l2-7l8,8L15,38z M36.2,37h-4.667L11,12.926L14.733,12L39,30.518L36.2,37z"></path>
    </svg>
    <span class="text-lg sm:text-xl md:text-2xl font-bold tracking-tight text-[#262626] dark:text-white">Project C</span>
  </a>

  <!-- Right Side Icons -->
  <div class="flex items-center gap-0.5 sm:gap-1">
    <button id="language-btn" class="rounded-lg p-1.5 sm:p-2 text-[#a3a3a3] dark:text-[#a3a3a3] text-[#525252] transition-all duration-200 hover:bg-[#282828] dark:hover:bg-[#282828] hover:bg-[#f5f5f5] hover:text-[#262626] dark:hover:text-[#e5e5e5] active:scale-90" aria-label="language" title="切换语言">
      <Icon name="languages" size={16} class="w-4 h-4 sm:w-[18px] sm:h-[18px] transition-transform duration-200" />
      </button>
    <button id="theme-btn" class="rounded-lg p-1.5 sm:p-2 text-[#a3a3a3] dark:text-[#a3a3a3] text-[#525252] transition-all duration-200 hover:bg-[#282828] dark:hover:bg-[#282828] hover:bg-[#f5f5f5] hover:text-[#262626] dark:hover:text-[#e5e5e5] active:scale-90" aria-label="theme" title="切换主题">
      <Icon id="theme-icon-moon" name="moon" size={16} class="w-4 h-4 sm:w-[18px] sm:h-[18px] hidden dark:block transition-all duration-300" />
      <Icon id="theme-icon-sun" name="sun" size={16} class="w-4 h-4 sm:w-[18px] sm:h-[18px] block dark:hidden transition-all duration-300" />
      </button>
    {isAdmin ? (
      <a href="/" class="rounded-lg p-1.5 sm:p-2 text-[#a3a3a3] dark:text-[#a3a3a3] text-[#525252] transition-all duration-200 hover:bg-[#282828] dark:hover:bg-[#282828] hover:bg-[#f5f5f5] hover:text-[#262626] dark:hover:text-[#e5e5e5] active:scale-90" aria-label="home">
        <Icon name="home" size={16} class="w-4 h-4 sm:w-[18px] sm:h-[18px] transition-transform duration-200" />
      </a>
    ) : (
      <a href="/admin" class="rounded-lg p-1.5 sm:p-2 text-[#a3a3a3] dark:text-[#a3a3a3] text-[#525252] transition-all duration-200 hover:bg-[#282828] dark:hover:bg-[#282828] hover:bg-[#f5f5f5] hover:text-[#262626] dark:hover:text-[#e5e5e5] active:scale-90" aria-label="admin">
      <Icon name="user" size={16} class="w-4 h-4 sm:w-[18px] sm:h-[18px] transition-transform duration-200" />
    </a>
    )}
    </div>
  </nav>

<script>
  (function() {
    // Language management
    function getSystemLanguage() {
      return navigator.language || (navigator.languages && navigator.languages[0]) || 'en';
    }

    function getStoredLanguage() {
      return localStorage.getItem('preferred-language');
    }

    function setLanguage(lang) {
      localStorage.setItem('preferred-language', lang);
      document.documentElement.lang = lang;
      // Trigger language change event for other components
      window.dispatchEvent(new CustomEvent('languagechange', { detail: { language: lang } }));
    }

    function getCurrentLanguage() {
      const stored = getStoredLanguage();
      if (stored) {
        return stored;
      }
      // Default to English, not system language
      return 'en';
    }

    function toggleLanguage() {
      const current = getCurrentLanguage();
      const newLang = current === 'zh' ? 'en' : 'zh';
      setLanguage(newLang);
      updateLanguageButton();
    }

    function updateLanguageButton() {
      const btn = document.getElementById('language-btn');
      if (btn) {
        // Update tooltip/aria-label based on current language
        const current = getCurrentLanguage();
        btn.setAttribute('aria-label', current === 'zh' ? 'Switch to English' : '切换到中文');
        btn.setAttribute('title', current === 'zh' ? 'Switch to English' : '切换到中文');
      }
    }

    // Theme management
    function getSystemTheme() {
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        return 'dark';
      }
      return 'light';
    }

    function getStoredTheme() {
      return localStorage.getItem('preferred-theme');
    }

    function setTheme(theme) {
      localStorage.setItem('preferred-theme', theme);
      applyTheme(theme);
    }

    function getCurrentTheme() {
      const stored = getStoredTheme();
      if (stored === 'dark' || stored === 'light') {
        return stored;
      }
      // Default to dark theme, not system theme
      return 'dark';
    }

    function toggleTheme() {
      const current = getCurrentTheme();
      const newTheme = current === 'dark' ? 'light' : 'dark';
      setTheme(newTheme);
    }

    function applyTheme(theme) {
      const html = document.documentElement;
      const body = document.body;
      if (theme === 'dark') {
        html.classList.add('dark');
        html.classList.remove('light');
        body.classList.add('dark');
        body.classList.remove('light');
      } else {
        html.classList.add('light');
        html.classList.remove('dark');
        body.classList.add('light');
        body.classList.remove('dark');
      }
      updateThemeIcon(theme);
      // Trigger theme change event for other components
      window.dispatchEvent(new CustomEvent('themechange', { detail: { theme: theme } }));
    }

    function updateThemeIcon(theme) {
      const moonIcon = document.getElementById('theme-icon-moon');
      const sunIcon = document.getElementById('theme-icon-sun');
      if (moonIcon && sunIcon) {
        // Add rotation animation on switch
        const showIcon = theme === 'dark' ? moonIcon : sunIcon;
        const hideIcon = theme === 'dark' ? sunIcon : moonIcon;
        
        // Animate out
        hideIcon.style.transform = 'rotate(-90deg) scale(0.5)';
        hideIcon.style.opacity = '0';
        
        setTimeout(() => {
          hideIcon.classList.remove('block');
          hideIcon.classList.add('hidden');
          hideIcon.style.transform = '';
          hideIcon.style.opacity = '';
          
          // Animate in
          showIcon.style.transform = 'rotate(90deg) scale(0.5)';
          showIcon.style.opacity = '0';
          showIcon.classList.remove('hidden');
          showIcon.classList.add('block');
          
          // Trigger reflow
          showIcon.offsetHeight;
          
          showIcon.style.transform = 'rotate(0deg) scale(1)';
          showIcon.style.opacity = '1';
        }, 150);
      }
      
      // Update monitor icon stroke color based on theme
      const monitorIcon = document.querySelector('.monitor-icon');
      if (monitorIcon) {
        if (theme === 'dark') {
          monitorIcon.style.setProperty('--monitor-stroke', '#c9d1d9');
        } else {
          monitorIcon.style.setProperty('--monitor-stroke', '#24292f');
        }
      }
    }

    // System theme listener removed - we use fixed defaults (English and Dark)

    // Initialize on page load
    function init() {
      // Initialize language
      const currentLang = getCurrentLanguage();
      setLanguage(currentLang);
      updateLanguageButton();

      // Initialize theme
      const currentTheme = getCurrentTheme();
      applyTheme(currentTheme);
      
      // Initialize monitor icon color
      const monitorIcon = document.querySelector('.monitor-icon');
      if (monitorIcon) {
        if (currentTheme === 'dark') {
          monitorIcon.style.setProperty('--monitor-stroke', '#c9d1d9');
        } else {
          monitorIcon.style.setProperty('--monitor-stroke', '#24292f');
        }
      }

      // Setup event listeners
      const languageBtn = document.getElementById('language-btn');
      const themeBtn = document.getElementById('theme-btn');

      if (languageBtn) {
        languageBtn.addEventListener('click', toggleLanguage);
      }

      if (themeBtn) {
        themeBtn.addEventListener('click', toggleTheme);
      }

      // System theme listener removed - we use fixed defaults
    }

    // Run initialization
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  })();
</script>

